<!doctype html><html lang=en-us><meta charset=utf-8><meta name=language content="english"><meta http-equiv=content-type content="text/html"><meta name=generator content="Hugo 0.81.0"><meta name=description content="Gastlit by a computer"><meta name=author content="Douglas Myers-Turnbull"><title>New data science steps with Python | Gaslit by a computer</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/index.css><link rel=canonical href=/data-science-setup/><link rel=alternate type=application/rss+xml href title="Gaslit by a computer"><header><h1><a href>Gaslit by a computer</a></h1></header><article><header><h1>New data science steps with Python</h1></header><p>This is a <em>draft</em>.</p><p>Here are steps for a typical initial setup for data science in Python.<br>I’ve given similar instructions so much that I figured I’d write this down.</p><h3 id=install-oh-my-zshhttpsohmyzsh>Install <a href=https://ohmyz.sh/>Oh My Zsh</a></h3><p>You’ll thank me later. (You’ll need ZSH installed for this to work.)</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>
chsh -s /usr/bin/env zsh
zsh
sh -c <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</code></pre></div><h3 id=configure-git>Configure Git</h3><p>First, configure your username and email:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git config --global user.name <span style=color:#e6db74>&#34;your_username&#34;</span>
git config --global user.email <span style=color:#e6db74>&#34;your_email@address.tld&#34;</span>
</code></pre></div><p>Generate SSH keys if needed:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ssh-keygen -t rsa -b <span style=color:#ae81ff>4096</span> -C <span style=color:#e6db74>&#34;your_email@example.com&#34;</span>
eval <span style=color:#66d9ef>$(</span>ssh-agent -s<span style=color:#66d9ef>)</span>
ssh-add ~/.ssh/id_rsa
</code></pre></div><p>Save to the default location and skip adding a passphrase. After,
<a href=https://docs.github.com/en/free-pro-team@latest/github/authenticating-to-github/adding-a-new-ssh-key-to-your-github-account>add the SSH key to GitHub</a>.
If you don’t already have a GPG key somewhere, run this, skipping the passphrase:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>gpg --full-generate-key
</code></pre></div><p>Now add the output from this into GitHub:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>gpg --list-secret-keys --keyid-format LONG
</code></pre></div><h3 id=install-miniconda>Install Miniconda</h3><p>Miniconda is a much better choice than Anaconda.<br>You don’t want to use your root environment anyway, so don’t bother with all of those extra packages.
Never install packages in your root environment.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
chmod u+x Miniconda3-latest-Linux-x86_64.sh
./Miniconda3-latest-Linux-x86_64.sh -b
</code></pre></div><p>Then, add this to <code>~/.condarc</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>pip_interop_enabled</span>: <span style=color:#66d9ef>false</span>
<span style=color:#f92672>channel_priority</span>: <span style=color:#ae81ff>strict</span>
<span style=color:#f92672>auto_update_conda</span>: <span style=color:#66d9ef>true</span>

<span style=color:#f92672>channels</span>:
  - <span style=color:#ae81ff>conda-forge</span>
</code></pre></div><p>The rationale is:</p><ul><li><code>pip_interop_enabled</code> is extremely slow and often doesn’t work anyway</li><li><code>strict</code> <code>channel_priority</code> greatly reduces conflicts</li><li>removing the <code>default</code> channel from <code>channels</code> ensures that only conda-forge is ever used</li></ul><h3 id=create-a-build-environment>Create a build environment</h3><p>Create an environment for just building and packaging Python projects.
You can also install reasonable other build software like pytest, but don’t go overboard.
Only use this environment for building.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>conda create <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --name build <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --force <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --yes <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  python<span style=color:#f92672>=</span>3.9

conda activate build
pip install poetry tox
</code></pre></div><h3 id=create-an-ml-playground-environment>Create an ML playground environment</h3><p>You can add packages in here and wreck it.
If it’s ruined, just rebuild by running the same command.</p><p>Add and remove packages at the bottom as needed.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>conda create <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --name playground <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --force <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --yes <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  python<span style=color:#f92672>=</span>3.9 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  jupyterlab numpy pandas pytorch scikit-learn tensorflow-gpu keras opencv3 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  jupyter-lab ipympl nb_conda_kernels

conda activate playground
</code></pre></div><p>If you are on Windows, add <code>pywin32</code> and <code>pywinutils</code>.
Some versions of <a href=https://github.com/mhammond/pywin32/issues/1431>pywin32 have issues</a>,
and the PyPi pywin32 package version 300 is broken.
You may need to run <code>/path/to/your/environment/pywin32_postinstall.py -install</code> after.</p><h4 id=configure-jupyter>Configure Jupyter</h4><p>Copy this to <code>~/.jupyter/jupyter_lab_config.py</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> pathlib <span style=color:#f92672>import</span> Path
c<span style=color:#f92672>.</span>ServerApp<span style=color:#f92672>.</span>root_dir <span style=color:#f92672>=</span> str(Path<span style=color:#f92672>.</span>home())
c<span style=color:#f92672>.</span>ServerApp<span style=color:#f92672>.</span>token <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
c<span style=color:#f92672>.</span>ServerApp<span style=color:#f92672>.</span>password <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
c<span style=color:#f92672>.</span>ServerApp<span style=color:#f92672>.</span>port <span style=color:#f92672>=</span> <span style=color:#ae81ff>8888</span>
c<span style=color:#f92672>.</span>ServerApp<span style=color:#f92672>.</span>port_retries <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
c<span style=color:#f92672>.</span>ServerApp<span style=color:#f92672>.</span>autoreload <span style=color:#f92672>=</span> False
</code></pre></div><p>Run a Jupyter server:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>jupyter lab --no-browser &amp;!
</code></pre></div><p>(The <code>&!</code> will keep it running even when the session quits.)
There’s no reason to set a password: It’s unlikely to add any security, and I wouldn’t rely on it.
Instead, if you want to access Jupyter remotely, use an SSH tunnel.<br>First, make sure to set up SSH keys to your server. For that, run this on your client:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ssh-keygen -t rsa -b <span style=color:#ae81ff>4096</span> -C <span style=color:#e6db74>&#34;your_email@example.com&#34;</span>
eval <span style=color:#66d9ef>$(</span>ssh-agent -s<span style=color:#66d9ef>)</span>
ssh-add ~/.ssh/id_rsa
ssh-copy-id
</code></pre></div><p>Now open the tunnel:</p><pre><code>ssh -L 8899:localhost:8888 myservername
</code></pre><p>Then leave that open and go to: <code>https://localhost:8899</code>.
Now you can lose the connection and your notebooks will still be there.</p><h4 id=building-real-packages-for-production>Building real packages for production</h4><p>The playground environment is your unreliable <em>I don’t care</em> workspace.</p><p>You should use an isolated build procedure for real projects, or whenever you care about
reproducibility. Your project lists exact dependency ranges and gets rebuilt from scratch
in a new virtualenv or conda env each build. That’s actually
<a href=https://dmyersturnbull.github.io/#-the-python-build-landscape>a normal procedure</a> for most
compiled languages. For example, Scala’s <a href=https://www.scala-sbt.org/>sbt</a> downloads and
caches dependencies listed in a <code>build.sbt</code> file, packaging them into your project.
Your projects don’t rely on a global environment that could change with a misplaced <code>conda</code>
or <code>pip install</code>.</p><p>You could make a conda environment each build, but Conda is slow, its dependency solver has bugs,
and it provides far fewer packages than PyPi. Unfortunately,
<a href=https://www.anaconda.com/blog/understanding-conda-and-pip>mixing Conda and Pip</a>
is problematic and can result in undetected dependency conflicts and package clobbering.
Consider instead using <a href=https://python-poetry.org/>Poetry</a>, which has more accurate dependency
resolution, better performance, and access to all packages that are on PyPi or are distributed
in <a href=https://pythonwheels.com/>wheels</a>. You can use
<a href=https://github.com/dmyersturnbull/tyrannosaurus>Tyrannosaurus</a> to generate projects that
have excellent <a href=https://en.wikipedia.org/wiki/CI/CD>CI/CD</a> via Poetry,
<a href=https://tox.readthedocs.io>Tox</a>, and <a href=https://github.com/features/actions>GitHub Actions</a>:
<code>tyrannosaurus new myprojectname --track</code>.</p></article></html>